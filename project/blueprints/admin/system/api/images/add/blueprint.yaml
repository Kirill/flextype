title: Create new token
icon:
  set: bootstrap
  name: file-text
emitter:
  addListener:
    - name: onAdminThemeTail
      properties:
        value: |
          <script>
            $('.js-submit-token-create-form').click(function () {
              $("input[name=redirect]").val($(this).data('redirect'));
              $("input[name=submit_form_token_create]").click();
            });
          </script>
blocks:
  - type: Container
    properties:
      breakpoint: medium
    blocks:
      - type: Row
        blocks:
          - type: Column
            blocks:
              - type: Form
                properties:
                  name: form_token_create
                  process:
                    fields:
                      - name: title
                        properties:
                          type: string
                      - name: limit_calls
                        properties:
                          type: int
                      - name: icon.name
                        properties:
                          type: string
                      - name: icon.set
                        properties:
                          type: string
                      - name: state
                        properties:
                          type: string
                      - name: calls
                        properties:
                          type: int
                          value: 0
                      - name: api
                        properties:
                          type: string
                          value: "{{ query.api }}"
                      - name: created_at
                        properties:
                          type: string
                          value: "{{ time }}"
                      - name: created_by
                        properties:
                          type: string
                          value: "{{ acl().getUserLoggedInUuid() }}"
                      - name: uuid
                        properties:
                          type: string
                          value: "{{ uuid }}"
                    messages: 
                      error: "{{ __('admin_message_entries_api_token_was_not_created') }}"
                      success: "{{ __('admin_message_entries_api_token_created') }}"
                    redirect:
                      route: |
                        {% if _form.registry.data.redirect == 'index' %}
                          admin.api.tokens
                        {% elseif _form.registry.data.redirect == 'edit' %}
                          admin.api.edit
                        {% elseif _form.registry.data.redirect == 'add' %}
                          admin.api.add
                        {% endif %}
                      args:
                        api: "{{ query.api }}"
                blocks:   
                  - type: Row
                    properties:
                      class: mt-4 mb-4
                    blocks:
                      - type: Column
                        properties:
                          size: 6/12
                        blocks:
                          - type: Heading
                            properties:
                              size: large
                              id: title
                              value: "{{ __('admin_create_new_token') }}"
                      - type: Column
                        properties:
                          size: 6/12
                          class: d-flex align-items-center justify-content-end text-end 
                        blocks:
                          - type: InputSubmit
                            properties:
                              name: submit_form_token_create
                              style:
                                display: none
                          - type: ButtonGroup
                            properties:
                              buttons:
                                - type: Button
                                  properties:
                                    value: "{{ __('admin_create') }}"
                                    class: js-submit-token-create-form
                                    data: 
                                      redirect: index
                                - type: ButtonToggle
                                  properties:
                                    type: secondary
                                    value: "{{ __('admin_create_and_edit') }}"    
                                    items:
                                      - href: "#"
                                        value: "{{ __('admin_create_and_edit') }}"
                                        class: js-submit-token-create-form
                                        data:
                                          redirect: edit
                                      - href: "#"
                                        value: "{{ __('admin_create_and_add') }}"
                                        class: js-submit-token-create-form
                                        data:
                                          redirect: add
                  - type: Row
                    properties:
                      class: g-3
                    blocks:
                      - type: Column
                        properties:
                          size: 12
                        blocks:
                          - type: InputHidden
                            properties:
                              name: redirect  
                          - type: InputText
                            properties:
                              name: title
                              label:
                                value: "{{ __('admin_title') }}"
                              class: js-title
                              help: "{{ __('admin_help_text_for_tokens_label') }}"
                              validation:
                                required: true
                                minlength: 1
                                errorMessage: "{{ __('admin_error_title_empty_input') }}"
                      - type: Column
                        properties:
                          size: 3/12
                        blocks:
                          - type: InputNumber
                            properties:
                              name: limit_calls
                              label:
                                value: "{{ __('admin_api_calls_limit') }}"
                              value: 0
                              help: "{{ __('admin_help_text_for_api_calls_limit_label') }}"
                              validation:
                                required: true
                                minlength: 1
                                errorMessage: "{{ __('admin_error_api_calls_empty_input') }}"
                      - type: Column
                        properties:
                          size: 3/12
                        blocks:
                          - type: Select2
                            properties:
                              name: state
                              value: enabled
                              items: 
                                enabled: "{{ __('admin_enabled') }}"
                                disabled: "{{ __('admin_disabled') }}"
                              label:
                                value: "{{ __('admin_state') }}"
                      - type: Column
                        properties:
                          size: 3/12
                        blocks:
                          - type: InputText
                            properties:
                              name: icon.name
                              label:
                                value: "{{ __('admin_icon_name') }}"
                              value: "newspaper"
                              class: js-title
                              help: "{{ __('admin_help_text_for_tokens_label') }}"
                              validation:
                                required: true
                                minlength: 1
                                errorMessage: "{{ __('form_admin_error_icon_empty_input') }}" 
                      - type: Column
                        properties:
                          size: 3/12
                        blocks:
                          - type: InputText
                            properties:
                              name: icon.set
                              label:
                                value: "{{ __('admin_icon_set') }}"
                              value: "bootstrap"
                              class: js-title
                              help: "{{ __('admin_help_text_for_tokens_label') }}"
                              validation:
                                required: true
                                minlength: 1
                                errorMessage: "{{ __('form_admin_error_icon_empty_input') }}"
                                   